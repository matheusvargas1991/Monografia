%================================================================
\chapter{O programa E-foto}
%================================================================

Nesse capítulo será apresentado o software E-foto, suas funcionalidades e o que deve ser feito para sua obtenção e instalação. Sendo explicado que pacotes serão necessários para o funcionamento do programa após e realização do seu download.
%fiz uma introduçaõ genérica, que deve ser modificada quando o projeto for mais completo

\section{O que é o E-foto}

O E-foto é um software live para fotogrametria digital que é desenvolvido pelo laboratório de fotogrametria da Universidade do Estado do Rio de Janeiro desde 2004 e tem como objetivo, além da criação de um software inteiramente funcional (uma estação fotogramétrica gratuita), levar aos alunos o conhecimento de forma gratuita sobre fotogrametria digital, sendo de forma didática ou ate mesmo na prática por meio de acesso ao código, uso da plataforma e até criação de novos módulos para o software. A fotogrametria é a obtenção de informações confiáveis por meio de imagens obtidas por sensores, sendo no caso da fotogrametria digital a entrada de dados são imagens digitais provenientes de máquinas digitais ou pela digitalização de imagens obtidas de forma analógica.

\section{Instalação do E-foto}
\subsection{Em Sistemas Linux}
\subsection{Em Sistemas Windows}

\subsection{Compilação do E-foto a partir dos fontes}
\subsection{Em Sistemas Linux}
% é necessário que você faça um verdadeiro passo a passo.
% detalhe cada passo. Pense que você está ensinando o seu pai a compilar o e-foto. Seja minucioso e sem ambiguidades. 

\subsubsection{Passo 1 - Baixar código fonte}
Primeiramente, para realizar a instalação do software E-foto, o usuário deve fazer o download do seu código fonte e para isso é necessário a instalação do subversion, se já não estiver instalado. Para tal, o usuário deve abrir o terminal do seu sistema Linux, que pode ser feito digitando terminal na barra de busca ao apertar a tecla do Windows no seu teclado ou pelo atalho do teclado \texttt{ctrl + alt + T}. Com o terminal aberto, o usuário começará a instalação do SVN com os comandos: 
\begin{lstlisting}[language=bash]
	$ sudo apt update
	$ sudo apt install subversion
\end{lstlisting}
% (que atualizará o gerenciador de pacotes)
 % e sudo apt install apache2 apache2-utils 
 %esses pacotes só são necessários se for criar um servidor svn, o que não é caso. Para baixar o e-foto, ou qualquer software por svn, basta instalar o subversion, sem o apache2. Veja em https://askubuntu.com/questions/258151/how-can-i-install-subversion-client-in-ubuntu
 %(que instalará os pacotes do apache2, onde Apache licencia um sistema de controle de versão de código aberto). Logo após execute o comando sudo apt-get install subversion libapache2-mod-svn subversion-tools libsvn-dev (que instalará o SVN e todas as dependências necessárias). Agora é preciso habilitar os módulos apache2 para o SVN funcionar e isso é feito com os comandos sudo a2enmod dav e sudo a2enmod dav\_svn. Então o usuário tem que reiniciar o Apache com o comando sudo service apache2 restart. O próximo passo é criar uma conta de usuário SVN que é feito com o comando sudo htpasswd -cm /etc/apache2/dav\_svn.passwd admin (nesse passo o usuário precisará fornecer sua senha de administrador). E o último passo de configuração do SVN é reiniciá-lo com o comando sudo systemctl restart apache2.service. 
 
Com o SVN instalado e configurado, basta o usuário digitar no terminal o comando:
 
\begin{lstlisting}[language=bash]
 $ svn checkout https://svn.code.sf.net/p/e-foto/code
\end{lstlisting}

Com a utilização desse comando o download de todo o código fonte do software E-foto será feito automaticamente.  
    
\subsubsection{Passo 2 - Instalar pacotes necessários à compilação}  
Após a realização do download do código fonte do E-foto, o usuário deve ficar atento aos pacotes necessários em seu ambiente para que o software E-foto possa ser instalado e ter seu funcionamento sem erros. Para a instalação dos pacotes o usuário deve buscar abrir novamente o terminal. Os pacotes necessários para instalação do e-foto são:
\begin{itemize}
   	\item libgdal.dev
   	\item build-essential
   	\item libfontconfig1
   	\item mesa-common-dev
   	\item libx11-xcb-dev
   	\item libglu1-mesa-dev
\end{itemize}
Cada pacote deve ser instalado com respectivamente com os seguintes comandos:	

\begin{lstlisting}[language=bash]
	$ sudo apt install libgdal-dev
	$ sudo apt install build-essential
	$ sudo apt install libfontconfig1
	$ sudo apt install mesa-common-dev
	$ sudo apt install libx11-xcb-dev 
	$ sudo apt install libglu1-mesa-dev
\end{lstlisting}				
	
O pacote libgdal.dev é o contém as funcionalidades da GDAL, onde GDAL é uma biblioteca de tradução para formatos geoespaciais. O pacote libfontconfig1 contém uma biblioteca projetada para achar fontes no sistema e selecioná-las de acordo com os requisitos especificados pelas aplicações, e o usuário deve instalar o driver XCB e o OpenGl através dos pacotes mesa-common-dev, libx11-xcb-dev e libglu1-mesa-dev. 
    
\subsection{Passo 3 - Instalar os pacotes de instalação do Qt 5}   
A instalação do Qt 5 via terminal deve ser feita através dos seguintes pacotes:
\begin{itemize}
	\item qt5-default
	\item qt5-qmake
\end{itemize}   
Esses pacotes devem ser instalados através dos seguintes comandos do terminal:
   
\begin{lstlisting}[language=bash]
	$ sudo apt install qt5-default
    $ sudo apt install -y qt5-qmake
\end{lstlisting}	
    
Após esses procedimentos o usuário ja terá um ambiente de compilação pronto para a instalação do E-foto, assim como o plataforma em que o mesmo foi desenvolvido.
    
\subsection{Passo 4 - Compilar e executar o software E-foto}
Para compilar e executar o código do E-foto via terminal, após a realização de todos os passos necessários, o usuário deve utilizar os seguintes comandos no terminal:
   
\begin{lstlisting}[language=bash]
   	$ cd diretório/
   	$ qmake e-foto.pro
   	$ make
   	$ ./build/bin/e-foto
\end{lstlisting}
   
O comando cd diretório/ servirá para o usuário percorrer o caminho até o diretório onde está o arquivo e-foto.pro (atualmente code/branches/e-foto-trunk-candidate), depois o qmake e o make irão realizar a compilação e gerar o executável do E-foto. Por fim o último comando irá executar o software E-foto.
   
   % Por último os pacotes para a instalação do Qt 5 propriamente dito que são os pacotes qt5-default, instalado através do comando no terminal sudo apt install qt5-default, e qt5-qmake, instalado através do comando sudo apt install -y qt5-qmake, que permitirão o uso do Qt 5 e consequentemente a instalação do Software E-foto

\subsection{Em Sistemas Windows}

Em sistemas Windows o usuário deve se certificar de estar utilizando um sistema de 64-bits pois não existe versão do E-foto para sistemas de 32-bits, para realizar esse procedimento de verificação de qual é a versão do sistema que está sendo utilizada basta digitar "informações do sistema" no menu iniciar, no menu Resumo do Sistema existe a opção Versão do Sistema que dará ao usuário essa informação. O próximo passo é o download dos pacotes binários do Gdal no Windows que pode ser realizado através desse link https://repo.msys2.org/distrib/x86\_64/msys2-x86\_64-20200720.exe, % sublinhas têm quie ser colocadas depois do caracter de escape \, senão o latex tenta interpŕetar como comando
  após a o download e da instalação do MSYS o usuário deve executar o que vai abrir o terminal do próprio MSYS que contém uma versão portada do gerenciador de pacotes Pacman, nessa ultima versão do Pacman deve ser digitado no terminal o código pacman -Syuu, que gerará um série de instruções a serem seguidas até que o usuário possa repetir o código e receber a mensagem de que nada necessita ser atualizado. Com o ambiente atualizado o usuário deve digitar o seguinte comando pacman -S mingw64/mingw-w64-x86\_64-gdal, que realizará finalmente o binário da GDAL. Após todo esse procedimento o usuário pode consultar no terminal do MSYS através do código gdalinfo --version se o gdal realmente foi instalado e a versão em que ele está disponível. Para seguir, o usuário deve possuir o Tortoise SVN que pode ser adquirido gratuitamente por esse link https://tortoisesvn.net/downloads.html, após a instalação do SVN o usuário deve buscar no programa a opção de SVN Checkout e no espaço para colar uma URL colocar https://svn.code.sf.net/p/e-foto/code, que deve gerar o download de todo o código fonte do E-foto. O Usuário deve, por ultimo, realizar o download do Qt 5 e do Qtcreator no website https://www.qt.io/download, deixando claro que na parte da instalação deve ser instalado apenas o mingw 64-bits, e o Qt 5 referente a esse sistema. Com os arquivos do código fonte do E-foto disponíveis o usuário deve procurar no caminho e-foto-code/branches/e-foto-trunk-candidate por um arquivo chamado e-foto.pro. Quando abrir o projeto no Qtcreator será necessário configurar o que deverá ser usado, começando pela escolha do kit que será usado que é o Qt 5 e o mingw 64-bits. Após o projeto estar aberto, o usuário deve ir na guia project e desmarcar a opção shadow build, e depois procurar na aba build a opção build E-foto, quando acabar a compilação é só buscar a opção Run e o E-foto vai abrir pronto para o uso.